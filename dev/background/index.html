<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Background · NFFT</title><link rel="canonical" href="https://tknopp.github.io/NFFT.jl/background/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="NFFT logo"/></a><div class="docs-package-name"><span class="docs-autofit">NFFT</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Background</a><ul class="internal"><li><a class="tocitem" href="#NDFT"><span>NDFT</span></a></li><li><a class="tocitem" href="#Matrix-Vector-Notation"><span>Matrix-Vector Notation</span></a></li><li><a class="tocitem" href="#NFFT"><span>NFFT</span></a></li><li><a class="tocitem" href="#Directional-NFFT"><span>Directional NFFT</span></a></li></ul></li><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../performance/">Performance</a></li><li><a class="tocitem" href="../tools/">Tools</a></li><li><a class="tocitem" href="../abstract/">AbstractNFFTs</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Background</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Background</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaMath/NFFT.jl/blob/master/docs/src/background.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Mathematical-Background"><a class="docs-heading-anchor" href="#Mathematical-Background">Mathematical Background</a><a id="Mathematical-Background-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-Background" title="Permalink"></a></h1><p>On this page we give a brief overview of the mathematical background of the NFFT. For a full background including a derivation of the NFFT we refer to the <a href="https://arxiv.org/pdf/2208.00049.pdf">NFFT.jl paper</a>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In the literature the NFFT has different names. Often it is called NUFFT, and in the MRI context gridding.</p></div></div><h2 id="NDFT"><a class="docs-heading-anchor" href="#NDFT">NDFT</a><a id="NDFT-1"></a><a class="docs-heading-anchor-permalink" href="#NDFT" title="Permalink"></a></h2><p>We first define the non-equidistant discrete Fourier transform (NDFT) that corresponds to the ordinary DFT. Let <span>$\bm{N} \in \mathbb{N}^D$</span> with <span>$D \in \mathbb{N}$</span> be the size of the <span>$D$</span>-dimensional  equidistantly sampled signal <span>$\bm{f} = (f_{\bm{n}})_{\bm{n} \in I_{\bm{N}}}$</span>. <span>$\bm{f}$</span> can for instance be a time or spatial domain signal. The signal is indexed using the multi-index set</p><p class="math-container">\[I_{\bm{N}} := \mathbb{Z}^D \cap \prod_{d=1}^D \left[-\frac{N_d}{2},\frac{N_d}{2}\right)\]</p><p>and thus represents a regular sampling that would also be considered when applying an ordinary DFT. The NDFT now maps from the equidistant domain to the non-equidistant domain and is defined as</p><p class="math-container">\[  	\hat{f}_j := \sum_{ \bm{n} \in I_{\bm{N}}} f_{\bm{n}} \, \mathrm{e}^{-2\pi\mathrm{i}\,\bm{n}\cdot\bm{k}_j}, \quad j=1,\dots, J \qquad \textit{(equidistant to non-equidistant)}\]</p><p>where the <span>$\bm{k}_j \in \mathbb{T}^D, j=1,\dots, J$</span> with <span>$J \in \mathbb{N}$</span> are the nonequidistant sampling nodes, <span>$\mathbb{T} := [1/2,1/2)$</span> is the torus and <span>$\hat{\bm{f}}$</span> is the <span>$D$</span>-dimensional frequency domain signal.</p><p>The direct NDFT has an associated adjoint that can be formulated as</p><p class="math-container">\[	y_{\bm{n}} = \sum_{j = 1}^{J} \hat{f}_j \, \mathrm{e}^{2 \pi \mathrm{i} \, \bm{n} \cdot \bm{k}_j}, \bm{n} \in I_{\bm{N}} \qquad \textit{(non-equidistant to equidistant)}.\]</p><p>We note that in general the adjoint NDFT is not the inverse NDFT. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The indices in the index set <span>$I_{\bm{N}}$</span> are centered around zero, which is the common definition of the NDFT. In contrast the indices of the DFT usually run from <span>$0,\dots,N_d-1$</span>. This means that an <code>fftshift</code> needs to be applied to change from one representation to the other.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Instead of the direct/adjoint NDFT terminology, there is an alternative classification that consists of three types. Type 1 corresponds to the adjoint NDFT, type 2 corresponds to the direct NDFT and type 3 corresponds to the NNDFT which has non-equidistant samples in both domains. Further information on this alternative formulation can be found <a href="https://finufft.readthedocs.io/en/latest/math.html">here</a>. </p></div></div><h2 id="Matrix-Vector-Notation"><a class="docs-heading-anchor" href="#Matrix-Vector-Notation">Matrix-Vector Notation</a><a id="Matrix-Vector-Notation-1"></a><a class="docs-heading-anchor-permalink" href="#Matrix-Vector-Notation" title="Permalink"></a></h2><p>The NDFT can be written as</p><p class="math-container">\[ \hat{\bm{f}} = \bm{A} \bm{f}\]</p><p>where</p><p class="math-container">\[\begin{aligned}
 \hat{\bm{f}} &amp;:= \left( \hat{f}_j \right)_{j=1}^{J} \in \mathbb{C}^J \\
 \bm{f} &amp;:= \left( f_{\bm{n}} \right)_{\bm{n} \in I_\mathbf{N}} \in \mathbb{C}^{|\bm{N}|}\\
  \bm{A} &amp;:=  \left( \mathrm{e}^{-2 \pi \mathrm{i} \, \bm{n} \cdot \bm{k}_j} \right)_{j=1,\dots,J; \bm{n} \in I_{\mathbf{N}}} \in \mathbb{C}^{J \times |\bm{N}|}
\end{aligned}\]</p><p>and where <span>$|\bm{N}| := \text{prod}(\bm{N})$</span>. The adjoint can then be written as</p><p class="math-container">\[ \bm{y} = \bm{A}^{\mathsf{H}}  \hat{\bm{f}}\]</p><p>where <span>$\bm{y} \in \mathbb{C}^{|\bm{N}|}$</span>.</p><h2 id="NFFT"><a class="docs-heading-anchor" href="#NFFT">NFFT</a><a id="NFFT-1"></a><a class="docs-heading-anchor-permalink" href="#NFFT" title="Permalink"></a></h2><p>The NFFT is an approximative algorithm that realizes the NDFT in just <span>${\mathcal O}(|\bm{N}| \log |\bm{N}| + J)$</span> steps. This is at the same level as the ordinary FFT with the exception of the additional linear term <span>$J$</span>, which is unavoidable since all nodes need to be touched as least once.</p><p>The NFFT has two important parameters that influence its accuracy:</p><ul><li>the window size parameter <span>$m \in \mathbb{N}$</span></li><li>the oversampling factor <span>$\sigma \in \mathbb{R}$</span> with <span>$\sigma &gt; 1$</span></li></ul><p>From the latter we can derive <span>$\tilde{\bm{N}} = \sigma \bm{N} \in (2\mathbb{N})^D$</span>. As the definition indicates, the oversampling factor <span>$\sigma$</span> is usually adjusted such that <span>$\tilde{\bm{N}}$</span> consists of even integers.</p><p>The NFFT now approximates <span>$\bm{A}$</span> by the product of three matrices</p><p class="math-container">\[\bm{A} \approx \bm{B} \bm{F} \bm{D}\]</p><p>where </p><ul><li><span>$\bm{F} \in \mathbb{C}^{|\tilde{\mathbf{N}}| \times |\tilde{\mathbf{N}}|}$</span> is the regular DFT matrix.</li><li><span>$\bm{D} \in \mathbb{C}^{|\tilde{\mathbf{N}}| \times |\mathbf{N}|}$</span> is a diagonal matrix that additionally includes zero filling and the fftshift. We call this the <em>deconvolution</em> matrix.</li><li><span>$\bm{B} \in \mathbb{C}^{M \times |\tilde{\mathbf{N}}|}$</span> is a sparse matrix implementing the discrete convolution with a window function <span>$\hat{\varphi}$</span>. We call this the <em>convolution</em> matrix.</li></ul><p>The NFFT is based on the convolution theorem. It applies a convolution in the non-equidistant domain, which is evaluated at equidistant sampling nodes. This convolution is then corrected in the equidistant domain by division with the inverse Fourier transform <span>$\hat{\varphi}$</span>. </p><p>The adjoint NFFT matrix approximates <span>$\bm{A}^{\mathsf{H}}$</span> by</p><p class="math-container">\[\bm{A}^{\mathsf{H}} \approx \bm{D}^{\mathsf{H}} \bm{F}^{\mathsf{H}}  \bm{B}^{\mathsf{H}} \]</p><p>Implementation-wise, the matrix-vector notation illustrates that the NFFT consists of three independent steps that are performed successively. </p><ul><li>The multiplication with <span>$\bm{D}$</span> is a scalar multiplication with the input-vector plus the shifting of data, which can be done inplace.</li><li>The FFT can be done with a high-performance FFT library such as the FFTW.</li><li>The multiplication with <span>$\bm{B}$</span> needs to run only over a subset of the indices and is the most challenging step.</li></ul><p>Since in practice the multiplication with <span>$\bm{B}$</span> is also the most expensive step, an NFFT library needs to pay special attention to optimizing it appropriately.</p><h2 id="Directional-NFFT"><a class="docs-heading-anchor" href="#Directional-NFFT">Directional NFFT</a><a id="Directional-NFFT-1"></a><a class="docs-heading-anchor-permalink" href="#Directional-NFFT" title="Permalink"></a></h2><p>In many cases one not just needs to apply a single NFFT but needs to apply many on different data. This leads us to the directional NFFT. The directional NFFT is defined as</p><p class="math-container">\[  	f_{\bm{l},j,\bm{r}} := \sum_{ \bm{n} \in I_{\bm{N}_\text{sub}}} \hat{f}_{\bm{l},\bm{n},\bm{r}} \, \mathrm{e}^{-2\pi\mathrm{i}\,\bm{n}\cdot\bm{k}_j}\]</p><p>where now <span>$(\bm{l}, \bm{k}, \bm{r}) \in I_\mathbf{N}$</span> and <span>$I_{\bm{N}_\text{sub}}$</span> is a subset of <span>$I_{\bm{N}}$</span>. The transform thus maps a <span>$D$</span>-dimensional tensor <span>$\hat{f}_{\bm{l},\bm{n},\bm{r}}$</span> to an <span>$R$</span>-dimensional tensor <span>$f_{\bm{l},j,\bm{r}}$</span>. <span>$\bm{N}_\text{sub}$</span> is thus a vector of length <span>$D-R+1$</span>. The indices <span>$\bm{l}$</span> and <span>$\bm{r}$</span> can also have length zero. Thus, for <span>$R=1$</span>, the conventional NFFT arises as a special case of the directional NFFT.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The directional NFFT can also be considered to be a slicing of a tensor with subsequent application of a regular NFFT. But the aforementioned formulation can be used to implement a much more efficient algorithm than can be achieved with slicing.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../overview/">Overview »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 21 January 2025 14:21">Tuesday 21 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
